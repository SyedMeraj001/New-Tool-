"use strict";(self.webpackChunkmy_react_app=self.webpackChunkmy_react_app||[]).push([[169],{133:(t,e,a)=>{a.d(e,{A:()=>n});class r{static logChange(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"system",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n={id:this.generateAuditId(),timestamp:(new Date).toISOString(),action:t,user:a,data:this.sanitizeData(e),metadata:r,sessionId:this.getSessionId(),ipAddress:this.getClientIP(),userAgent:navigator.userAgent};return this.auditLog.unshift(n),this.auditLog.length>this.maxLogSize&&(this.auditLog=this.auditLog.slice(0,this.maxLogSize)),this.persistAuditLog(),n.id}static generateAuditId(){return`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getSessionId(){let t=sessionStorage.getItem("esg_session_id");return t||(t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("esg_session_id",t)),t}static getClientIP(){return"client_ip_masked"}static sanitizeData(t){if(!t)return null;const e=JSON.parse(JSON.stringify(t));this.removeSensitiveFields(e,["password","token","secret","key"]);const a=JSON.stringify(e);return a.length>5e3?{_truncated:!0,_originalSize:a.length,summary:this.createDataSummary(e)}:e}static removeSensitiveFields(t,e){"object"===typeof t&&null!==t&&Object.keys(t).forEach(a=>{e.some(t=>a.toLowerCase().includes(t))?t[a]="[REDACTED]":"object"===typeof t[a]&&this.removeSensitiveFields(t[a],e)})}static createDataSummary(t){return Array.isArray(t)?{type:"array",length:t.length,sample:t.slice(0,2)}:"object"===typeof t?{type:"object",keys:Object.keys(t),sampleValues:Object.fromEntries(Object.entries(t).slice(0,3))}:t}static persistAuditLog(){try{localStorage.setItem("esg_audit_log",JSON.stringify(this.auditLog))}catch(t){console.warn("Failed to persist audit log:",t)}}static loadAuditLog(){try{const t=localStorage.getItem("esg_audit_log");t&&(this.auditLog=JSON.parse(t))}catch(t){console.warn("Failed to load audit log:",t),this.auditLog=[]}}static getAuditLog(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[...this.auditLog];return t.user&&(e=e.filter(e=>e.user.toLowerCase().includes(t.user.toLowerCase()))),t.action&&(e=e.filter(e=>e.action.toLowerCase().includes(t.action.toLowerCase()))),t.startDate&&(e=e.filter(e=>new Date(e.timestamp)>=new Date(t.startDate))),t.endDate&&(e=e.filter(e=>new Date(e.timestamp)<=new Date(t.endDate))),t.sessionId&&(e=e.filter(e=>e.sessionId===t.sessionId)),e}static trackDataEntry(t,e){return this.logChange("DATA_ENTRY",t,e,{category:"esg_data",recordCount:Array.isArray(t)?t.length:1,categories:this.extractCategories(t)})}static trackDataUpdate(t,e,a){const r=this.detectChanges(t,e);return this.logChange("DATA_UPDATE",{changes:r,newData:e},a,{category:"esg_data",changeCount:r.length,fieldsChanged:r.map(t=>t.field)})}static trackDataDeletion(t,e){return this.logChange("DATA_DELETE",t,e,{category:"esg_data",recordCount:Array.isArray(t)?t.length:1})}static trackApproval(t,e,a){return this.logChange("APPROVAL_ACTION",{data:t,decision:a},e,{category:"workflow",decision:a,recordCount:Array.isArray(t)?t.length:1})}static trackLogin(t){return this.logChange("USER_LOGIN",null,t,{category:"authentication"})}static trackLogout(t){return this.logChange("USER_LOGOUT",null,t,{category:"authentication"})}static trackReportGeneration(t,e,a){return this.logChange("REPORT_GENERATED",a,e,{category:"reporting",reportType:t})}static detectChanges(t,e){const a=[];if(!t||!e)return a;const r=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object.keys(e).forEach(i=>{const s=n?`${n}.${i}`:i;t[i]!==e[i]&&("object"===typeof e[i]&&null!==e[i]&&"object"===typeof t[i]&&null!==t[i]?r(t[i],e[i],s):a.push({field:s,oldValue:t[i],newValue:e[i],changeType:void 0===t[i]?"added":"modified"}))}),Object.keys(t).forEach(r=>{if(!(r in e)){const e=n?`${n}.${r}`:r;a.push({field:e,oldValue:t[r],newValue:void 0,changeType:"deleted"})}})};return r(t,e),a}static extractCategories(t){return t?Array.isArray(t)?[...new Set(t.map(t=>t.category).filter(Boolean))]:t.category?[t.category]:Object.keys(t).filter(t=>["environmental","social","governance"].includes(t)):[]}static generateAuditReport(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.getAuditLog(t);return{generatedAt:(new Date).toISOString(),totalEntries:e.length,dateRange:{start:e.length>0?e[e.length-1].timestamp:null,end:e.length>0?e[0].timestamp:null},summary:this.generateAuditSummary(e),entries:e.map(t=>{var e;return{...t,data:null!==(e=t.data)&&void 0!==e&&e._truncated?"[TRUNCATED]":t.data}})}}static generateAuditSummary(t){const e={actionCounts:{},userCounts:{},categoryCounts:{},dailyActivity:{}};return t.forEach(t=>{var a;e.actionCounts[t.action]=(e.actionCounts[t.action]||0)+1,e.userCounts[t.user]=(e.userCounts[t.user]||0)+1,null!==(a=t.metadata)&&void 0!==a&&a.category&&(e.categoryCounts[t.metadata.category]=(e.categoryCounts[t.metadata.category]||0)+1);const r=t.timestamp.split("T")[0];e.dailyActivity[r]=(e.dailyActivity[r]||0)+1}),e}static exportAuditLog(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=this.generateAuditReport(e);return"csv"===t?this.convertToCSV(a.entries):JSON.stringify(a,null,2)}static convertToCSV(t){if(0===t.length)return"";return[["Timestamp","Action","User","Session ID","Metadata"],...t.map(t=>[t.timestamp,t.action,t.user,t.sessionId,JSON.stringify(t.metadata||{})])].map(t=>t.map(t=>`"${String(t).replace(/"/g,'""')}"`).join(",")).join("\n")}static clearAuditLog(){this.auditLog=[],localStorage.removeItem("esg_audit_log")}static getAuditStats(){return{totalEntries:this.auditLog.length,oldestEntry:this.auditLog.length>0?this.auditLog[this.auditLog.length-1].timestamp:null,newestEntry:this.auditLog.length>0?this.auditLog[0].timestamp:null,uniqueUsers:[...new Set(this.auditLog.map(t=>t.user))].length,uniqueSessions:[...new Set(this.auditLog.map(t=>t.sessionId))].length}}}r.auditLog=[],r.maxLogSize=1e3,r.loadAuditLog();const n=r},1894:(t,e,a)=>{a.d(e,{A:()=>r});const r=class{static async request(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const a=await fetch(`http://localhost:3004/api${t}`,{headers:{"Content-Type":"application/json",...e.headers},...e});return a.ok?await a.json():{error:"API Error"}}catch(a){return console.warn("API unavailable:",a.message),{error:"Backend offline"}}}static configureERP(t){return this.request("/integrations/erp/configure",{method:"POST",body:JSON.stringify(t)})}static syncERP(){return this.request("/integrations/erp/sync",{method:"POST"})}static configureHR(t){return this.request("/integrations/hr/configure",{method:"POST",body:JSON.stringify(t)})}static syncHR(){return this.request("/integrations/hr/sync",{method:"POST"})}static getIntegrationStatus(){return this.request("/integrations/status")}static async saveESGData(t){try{const e=await this.request("/esg/data",{method:"POST",body:JSON.stringify(t)});if(e.error)throw new Error(e.error);return e}catch(e){return console.error("Failed to save ESG data:",e),!1}}static validateCompliance(t){return this.request("/compliance/validate",{method:"POST",body:JSON.stringify(t)})}static calculateGHG(t){return this.request("/ghg/calculate",{method:"POST",body:JSON.stringify(t)})}static saveESGData(t){return this.request("/esg/data",{method:"POST",body:JSON.stringify(t)})}static getESGData(t){return this.request(`/esg/data/${t}`)}static getESGScores(t){return this.request(`/esg/scores/${t}`)}static getESGKPIs(t){return this.request(`/esg/kpis/${t}`)}static getAnalyticsData(t){return this.request(`/esg/analytics/${t}`)}}},4191:(t,e,a)=>{a.d(e,{A:()=>n});class r{static validateESGData(t){const e={isValid:!0,errors:[],warnings:[],suggestions:[],score:100};return t&&"object"===typeof t?(["environmental","social","governance"].forEach(a=>{if(t[a]){const r=this.validateCategory(a,t[a]);e.errors.push(...r.errors),e.warnings.push(...r.warnings),e.suggestions.push(...r.suggestions),r.errors.length>0&&(e.isValid=!1)}}),e.score=this.calculateValidationScore(e),this.performCrossValidation(t,e),e):(e.isValid=!1,e.errors.push("Invalid data format provided"),e.score=0,e)}static validateCategory(t,e){const a={errors:[],warnings:[],suggestions:[]},r=this.validationRules[t]||{};return Object.entries(e).forEach(e=>{let[n,i]=e;if("description"===n)return;const s=r[n];if(!s)return void a.warnings.push(`Unknown metric '${n}' in ${t} category`);if(s.required&&(null===i||void 0===i||""===i))return void a.errors.push(`${n} is required in ${t} category`);if(!s.required&&(null===i||void 0===i||""===i))return;const o=parseFloat(i);isNaN(o)?a.errors.push(`${n} must be a valid number`):(o<s.min&&a.errors.push(`${n} cannot be less than ${s.min} ${s.unit}`),o>s.max&&a.errors.push(`${n} cannot exceed ${s.max} ${s.unit}`),this.performBusinessLogicValidation(t,n,o,a))}),a}static performBusinessLogicValidation(t,e,a,r){"environmental"===t&&("renewableEnergyRatio"===e&&a>95&&r.warnings.push("Renewable energy ratio above 95% is exceptional - please verify"),"carbonEmissions"===e&&0===a&&r.warnings.push("Zero carbon emissions reported - please confirm accuracy")),"social"===t&&("femaleEmployeesPercentage"===e&&(a<10||a>90)&&r.warnings.push("Gender distribution appears imbalanced - consider diversity initiatives"),"employeeTurnover"===e&&a>30&&r.warnings.push("High employee turnover detected - may indicate retention issues")),"governance"===t&&("independentDirectors"===e&&a<30&&r.warnings.push("Low board independence - consider increasing independent directors"),"dataBreaches"===e&&a>0&&r.warnings.push("Data breaches reported - ensure proper cybersecurity measures"))}static performCrossValidation(t,e){const a=t.environmental||{},r=t.social||{},n=t.governance||{};if(a.energyConsumption&&a.carbonEmissions){a.carbonEmissions/a.energyConsumption>1&&e.warnings.push("Carbon emissions seem high relative to energy consumption")}if(r.totalEmployees&&n.boardSize&&r.totalEmployees<50&&n.boardSize>10&&e.warnings.push("Board size appears large for company size"),r.communityInvestment&&t.totalRevenue){r.communityInvestment/t.totalRevenue*100>10&&e.warnings.push("Community investment ratio is exceptionally high")}}static calculateValidationScore(t){let e=100;return e-=20*t.errors.length,e-=5*t.warnings.length,Math.max(0,e)}static validateDataCompleteness(t){const e={environmental:0,social:0,governance:0,overall:0};return["environmental","social","governance"].forEach(a=>{const r=t[a]||{},n=this.validationRules[a]||{},i=Object.keys(n).length,s=Object.keys(r).filter(t=>"description"!==t&&null!==r[t]&&void 0!==r[t]&&""!==r[t]).length;e[a]=i>0?Math.round(s/i*100):0}),e.overall=Math.round((e.environmental+e.social+e.governance)/3),e}static generateValidationReport(t){const e=this.validateESGData(t),a=this.validateDataCompleteness(t);return{timestamp:(new Date).toISOString(),validationScore:e.score,completenessScore:a.overall,status:e.isValid?"passed":"failed",summary:{totalErrors:e.errors.length,totalWarnings:e.warnings.length,totalSuggestions:e.suggestions.length},details:{errors:e.errors,warnings:e.warnings,suggestions:e.suggestions,completeness:a},recommendations:this.generateRecommendations(e,a)}}static generateRecommendations(t,e){const a=[];return e.overall<70&&a.push({type:"completeness",priority:"high",message:"Data completeness is below 70%. Consider filling missing fields for better ESG reporting."}),t.errors.length>0&&a.push({type:"validation",priority:"critical",message:"Critical validation errors found. Please address all errors before submission."}),t.warnings.length>3&&a.push({type:"quality",priority:"medium",message:"Multiple data quality warnings detected. Review and verify data accuracy."}),a}static getValidationRulesForCategory(t){return this.validationRules[t]||{}}static isValidMetric(t,e){return!(!this.validationRules[t]||!this.validationRules[t][e])}}r.validationRules={environmental:{energyConsumption:{min:0,max:1e6,unit:"kWh",required:!0},carbonEmissions:{min:0,max:1e5,unit:"T CO2e",required:!0},waterUsage:{min:0,max:1e6,unit:"m\xb3",required:!1},wasteGenerated:{min:0,max:1e4,unit:"tons",required:!1},renewableEnergyRatio:{min:0,max:100,unit:"%",required:!1}},social:{totalEmployees:{min:1,max:1e6,unit:"count",required:!0},femaleEmployeesPercentage:{min:0,max:100,unit:"%",required:!1},trainingHours:{min:0,max:1e3,unit:"hours",required:!1},communityInvestment:{min:0,max:1e7,unit:"USD",required:!1},employeeTurnover:{min:0,max:100,unit:"%",required:!1}},governance:{boardSize:{min:3,max:20,unit:"count",required:!0},independentDirectors:{min:0,max:100,unit:"%",required:!0},ethicsTraining:{min:0,max:100,unit:"%",required:!1},dataBreaches:{min:0,max:1e3,unit:"count",required:!1},regulatoryFines:{min:0,max:1e8,unit:"USD",required:!1}}};const n=r},6169:(t,e,a)=>{a.d(e,{YF:()=>c,iu:()=>o});var r=a(1894),n=a(4191),i=a(133);const s=new class{constructor(){this.data=this.loadFromStorage()}loadFromStorage(){const t=localStorage.getItem("esg_database");return t?JSON.parse(t):{entries:[],compliance:[],kpis:{overallScore:0,complianceRate:0,environmental:0,social:0,governance:0,totalEntries:0,lastUpdated:(new Date).toISOString()},trends:[]}}saveToStorage(){localStorage.setItem("esg_database",JSON.stringify(this.data))}addEntry(t){const e={...t,id:Date.now(),timestamp:(new Date).toISOString(),status:"active"};return this.data.entries.push(e),this.updateKPIs(),this.saveToStorage(),e}getEntries(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.data.entries.filter(t=>"active"===t.status);return t.category&&(e=e.filter(e=>e.category===t.category)),t.dateFrom&&(e=e.filter(e=>new Date(e.timestamp)>=new Date(t.dateFrom))),t.dateTo&&(e=e.filter(e=>new Date(e.timestamp)<=new Date(t.dateTo))),e}addComplianceDoc(t){const e={...t,id:Date.now(),uploadedAt:(new Date).toISOString(),status:t.status||"Pending Review"};return this.data.compliance.push(e),this.saveToStorage(),e}getComplianceDocs(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.data.compliance;return t.category&&(e=e.filter(e=>e.category&&e.category.toLowerCase()===t.category.toLowerCase())),t.status&&(e=e.filter(e=>e.status===t.status)),e}updateKPIs(){const t=this.getEntries(),e=this.data.compliance,a=t.filter(t=>"environmental"===t.category),r=t.filter(t=>"social"===t.category),n=t.filter(t=>"governance"===t.category),i=this.calculateCategoryScore(a),s=this.calculateCategoryScore(r),o=this.calculateCategoryScore(n),c=Math.round(.4*i+.3*s+.3*o),l=e.filter(t=>"Approved"===t.status).length,g=e.length>0?Math.round(l/e.length*100):0;this.data.kpis={overallScore:c,complianceRate:g,environmental:i,social:s,governance:o,totalEntries:t.length,lastUpdated:(new Date).toISOString()},this.data.trends.push({timestamp:(new Date).toISOString(),overallScore:c,environmental:i,social:s,governance:o}),this.data.trends.length>30&&(this.data.trends=this.data.trends.slice(-30)),this.saveToStorage()}calculateCategoryScore(t){if(0===t.length)return 0;let e=0;return t.forEach(t=>{const a=t.target>0?t.value/t.target*100:50,r=Math.min(Math.max(a,0),100);e+=r}),Math.round(e/t.length)}getKPIs(){return this.data.kpis}getTrends(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;const e=new Date;return e.setDate(e.getDate()-t),this.data.trends.filter(t=>new Date(t.timestamp)>=e)}getCategoryDistribution(){const t=this.getEntries();return{environmental:t.filter(t=>"environmental"===t.category).length,social:t.filter(t=>"social"===t.category).length,governance:t.filter(t=>"governance"===t.category).length}}getRiskDistribution(){const t=this.getEntries();return{high:t.filter(t=>"high"===t.riskLevel).length,medium:t.filter(t=>"medium"===t.riskLevel).length,low:t.filter(t=>"low"===t.riskLevel).length}}getMonthlyTrends(){const t=this.getEntries(),e={};return t.forEach(t=>{const a=new Date(t.timestamp).toLocaleDateString("en-US",{month:"short",year:"numeric"});e[a]=(e[a]||0)+1}),e}getReportData(t){const e=this.getEntries(),a=this.getKPIs(),r=this.getComplianceDocs();return{template:t,generatedAt:(new Date).toISOString(),kpis:a,entries:e.slice(0,10),compliance:r.slice(0,5),categoryDistribution:this.getCategoryDistribution(),trends:this.getTrends(7)}}},o=async t=>{const e=localStorage.getItem("currentUser")||"defaultUser",a={...t,id:t.id||Date.now().toString(),createdBy:e,createdAt:(new Date).toISOString(),version:(t.version||0)+1};if(t.category&&t.metric)try{const r=n.A.validateESGData({[t.category]:{[t.metric]:t.value}});if(!r||!r.isValid){const t=r&&r.errors?r.errors.join(", "):"Unknown validation error";throw new Error(`Validation failed: ${t}`)}a.qualityScore=r.qualityScore,a.complianceStatus=r.complianceStatus,a.auditTrail=[i.A.trackDataEntry(t,e)]}catch(c){throw c}else a.auditTrail=[i.A.trackDataEntry(t,e)];const o={companyName:t.companyName||a.companyName||"Unknown",sector:t.sector||"",region:t.region||"",reportingYear:t.reportingYear||(new Date).getFullYear(),environmental:t.environmental||("environmental"===t.category?{[t.metric]:t.value}:{}),social:t.social||("social"===t.category?{[t.metric]:t.value}:{}),governance:t.governance||("governance"===t.category?{[t.metric]:t.value}:{}),userId:e,timestamp:(new Date).toISOString()};try{const t=await r.A.saveESGData(o);if(t&&!t.error){try{s&&"function"===typeof s.addEntry&&s.addEntry(a)}catch(l){console.warn("esgDB.addEntry failed:",l)}try{const t=JSON.parse(localStorage.getItem("esgData")||"[]");t.push(a),localStorage.setItem("esgData",JSON.stringify(t))}catch(l){console.warn("Failed to write esgData to localStorage:",l)}return{success:!0,source:"backend",data:a}}throw new Error((null===t||void 0===t?void 0:t.error)||"Backend save failed")}catch(g){console.warn("Backend save failed, falling back to localStorage:",g);try{const t=JSON.parse(localStorage.getItem("esgData")||"[]");t.push(a),localStorage.setItem("esgData",JSON.stringify(t)),console.log("Saved to localStorage, total entries:",t.length)}catch(c){console.warn("Failed to persist to localStorage",c)}try{s&&"function"===typeof s.addEntry&&s.addEntry(a)}catch(l){console.warn("esgDB.addEntry failed:",l)}return{success:!0,source:"localStorage",data:a}}},c=async()=>{const t=localStorage.getItem("currentUser")||"defaultUser";try{const t=localStorage.getItem("esgData");if(t){const e=JSON.parse(t);if(Array.isArray(e)&&e.length>0)return console.log("Found data in localStorage:",e.length,"entries"),e}}catch(e){console.warn("Failed to read esgData from localStorage",e)}try{const e=await r.A.getESGData(t);if(e&&!e.error){if(Array.isArray(e)&&e.length>0)return e;if(e.data&&Array.isArray(e.data)&&e.data.length>0)return e.data}}catch(a){console.warn("Backend unavailable, no data found")}return console.log("No ESG data found in localStorage or backend"),[]};"undefined"===typeof window||localStorage.getItem("esg_database")||(s&&"function"===typeof s.updateKPIs?s.updateKPIs():console.warn("esgDB not available yet \u2014 skipping initializeStorage"))}}]);
//# sourceMappingURL=169.1a778f65.chunk.js.map